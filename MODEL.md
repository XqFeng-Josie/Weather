# æ¨¡å‹æ¶æ„è¯¦è§£

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»é¡¹ç›®ä¸­æ‰€æœ‰æ¨¡å‹çš„æ¶æ„ã€è¾“å…¥è¾“å‡ºã€å·¥ä½œåŸç†åŠå…¶ä¸å¤©æ°”é¢„æµ‹ä»»åŠ¡çš„å…³ç³»ã€‚

## ğŸ“‹ ç›®å½•

1. [ä»»åŠ¡æ¦‚è¿°](#ä»»åŠ¡æ¦‚è¿°)
2. [ä¼ ç»Ÿæ·±åº¦å­¦ä¹ æ¨¡å‹](#ä¼ ç»Ÿæ·±åº¦å­¦ä¹ æ¨¡å‹)
   - [Linear Regression](#linear-regression)
   - [LSTM](#lstm)
   - [Transformer (åºåˆ—å»ºæ¨¡)](#transformer-åºåˆ—å»ºæ¨¡)
   - [CNN](#cnn)
   - [ConvLSTM](#convlstm)
   - [Weather Transformer](#weather-transformer)
3. [WeatherDiff æ¨¡å—](#weatherdiff-æ¨¡å—)
   - [VAE (Stable Diffusion VAE)](#stable-diffusion-vae)
   - [RAE (Representation Autoencoder)](#rae-representation-autoencoder)
   - [Pixel U-Net](#pixel-u-net)
   - [Latent U-Net](#latent-u-net)
   - [Diffusion Model](#diffusion-model)
4. [æ¨¡å‹å¯¹æ¯”ä¸é€‰æ‹©](#æ¨¡å‹å¯¹æ¯”ä¸é€‰æ‹©)

---

## ä»»åŠ¡æ¦‚è¿°

### é¢„æµ‹ä»»åŠ¡å®šä¹‰

**ç›®æ ‡**: åŸºäºè¿‡å»12ä¸ªæ—¶é—´æ­¥ï¼ˆ3å¤©ï¼Œæ¯6å°æ—¶ä¸€ä¸ªæ—¶é—´æ­¥ï¼‰çš„å¤©æ°”æ•°æ®ï¼Œé¢„æµ‹æœªæ¥4ä¸ªæ—¶é—´æ­¥ï¼ˆ1å¤©ï¼‰çš„å¤©æ°”çŠ¶å†µã€‚

**æ•°æ®æ ¼å¼**:
- **è¾“å…¥**: `(batch, input_length=12, channels, H=32, W=64)`
  - `input_length=12`: è¿‡å»3å¤©çš„æ•°æ®ï¼ˆ12ä¸ª6å°æ—¶é—´éš”ï¼‰
  - `channels`: æ°”è±¡å˜é‡æ•°ï¼ˆå¦‚æ¸©åº¦ã€æ°”å‹ç­‰ï¼‰
  - `H=32, W=64`: ç©ºé—´åˆ†è¾¨ç‡ï¼ˆçº¬åº¦Ã—ç»åº¦ï¼Œç­‰è§’ç½‘æ ¼ï¼‰
  
- **è¾“å‡º**: `(batch, output_length=4, channels, H=32, W=64)`
  - `output_length=4`: æœªæ¥1å¤©çš„é¢„æµ‹ï¼ˆ4ä¸ª6å°æ—¶é—´éš”ï¼‰

**æ•°æ®å½’ä¸€åŒ–**:
- **ä¼ ç»Ÿæ¨¡å‹**: Z-scoreå½’ä¸€åŒ–ï¼ˆå‡å€¼0ï¼Œæ ‡å‡†å·®1ï¼‰
- **WeatherDiffæ¨¡å—**: MinMaxå½’ä¸€åŒ–åˆ°[-1, 1]ï¼ˆé€‚é…Stable Diffusion VAEï¼‰

### æ ¸å¿ƒæŒ‘æˆ˜

1. **æ—¶ç©ºä¾èµ–**: å¤©æ°”ç³»ç»Ÿå…·æœ‰å¤æ‚çš„æ—¶ç©ºç›¸å…³æ€§
2. **å¤šå°ºåº¦ç‰¹å¾**: ä»å±€éƒ¨å¯¹æµåˆ°å…¨çƒç¯æµæ¨¡å¼
3. **ä¸ç¡®å®šæ€§**: å¤©æ°”ç³»ç»Ÿå…·æœ‰å†…åœ¨çš„æ··æ²Œç‰¹æ€§
4. **è®¡ç®—æ•ˆç‡**: å…¨çƒ64Ã—32ç½‘æ ¼ï¼Œéœ€è¦é«˜æ•ˆå¤„ç†

---

## ä¼ ç»Ÿæ·±åº¦å­¦ä¹ æ¨¡å‹

### Linear Regression

#### æ¨¡å‹ç»“æ„

```python
# å•å˜é‡ç‰ˆæœ¬ (lr)
X: (batch, 12, features) â†’ å±•å¹³ â†’ (batch, 12*features)
y: (batch, 4, features) â†’ å±•å¹³ â†’ (batch, 4*features)
Ridge(alpha=1.0).fit(X_flat, y_flat)

# å¤šå˜é‡ç‰ˆæœ¬ (lr_multi)
# æ¯ä¸ªå˜é‡ç‹¬ç«‹è®­ç»ƒä¸€ä¸ªRidgeæ¨¡å‹
for var in variables:
    model[var] = Ridge(alpha=10.0)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, 12, features)` - å±•å¹³åä¸º `(batch, 12*features)`
- **è¾“å‡º**: `(batch, 4, features)` - å±•å¹³åä¸º `(batch, 4*features)`
- **å‚æ•°**: L2æ­£åˆ™åŒ–ç³»æ•° `alpha`

#### å·¥ä½œåŸç†

- **çº¿æ€§æ˜ å°„**: ç›´æ¥å­¦ä¹ ä»è¾“å…¥åˆ°è¾“å‡ºçš„çº¿æ€§å˜æ¢
- **æ— æ—¶åºå»ºæ¨¡**: å°†æ—¶é—´åºåˆ—å±•å¹³ï¼Œä¸¢å¤±æ—¶é—´é¡ºåºä¿¡æ¯
- **æ— ç©ºé—´å»ºæ¨¡**: å°†ç©ºé—´ç½‘æ ¼å±•å¹³ï¼Œä¸¢å¤±ç©ºé—´ç»“æ„

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**: 
  - è®­ç»ƒæå¿«ï¼Œé€‚åˆå¿«é€ŸåŸºçº¿æµ‹è¯•
  - å‚æ•°é‡å°‘ï¼Œä¸æ˜“è¿‡æ‹Ÿåˆ
- **å±€é™**: 
  - æ— æ³•å»ºæ¨¡éçº¿æ€§æ—¶ç©ºä¾èµ–
  - é¢„æµ‹ç²¾åº¦ä½ï¼Œä»…ä½œä¸ºbaseline

#### é€‚ç”¨åœºæ™¯

- âœ… å¿«é€ŸéªŒè¯æ•°æ®æµ
- âœ… å•å˜é‡ç®€å•é¢„æµ‹
- âŒ ä¸é€‚åˆå®é™…åº”ç”¨

#### æ‰©å±•ï¼šMulti-Output Linear Regression

`src/models/linear_regression.py` ä¸­è¿˜å®ç°äº† `MultiOutputLinearRegression`ï¼š

**æ¨¡å‹ç»“æ„**:
```python
# æ¯ä¸ªå˜é‡ç‹¬ç«‹è®­ç»ƒä¸€ä¸ªRidgeæ¨¡å‹
for var in variables:
    X_flat = (n_samples, input_length * total_features)  # æ‰€æœ‰å˜é‡çš„ç‰¹å¾
    y_var = (n_samples, output_length * grid_points_per_var)  # ä»…è¯¥å˜é‡çš„ç½‘æ ¼ç‚¹
    model[var] = Ridge(alpha=10.0).fit(X_scaled, y_scaled)
```

**ç‰¹ç‚¹**:
- **æ¯ä¸ªå˜é‡ä¸€ä¸ªæ¨¡å‹**: ä¾‹å¦‚2m_temperatureä¸€ä¸ªæ¨¡å‹ï¼Œgeopotentialä¸€ä¸ªæ¨¡å‹
- **å…±äº«è¾“å…¥ç‰¹å¾**: æ‰€æœ‰å˜é‡ä½¿ç”¨ç›¸åŒçš„è¾“å…¥ç‰¹å¾ï¼ˆåŒ…å«æ‰€æœ‰å˜é‡çš„å†å²æ•°æ®ï¼‰
- **ç‹¬ç«‹é¢„æµ‹**: æ¯ä¸ªæ¨¡å‹åªé¢„æµ‹å¯¹åº”å˜é‡çš„æ‰€æœ‰ç½‘æ ¼ç‚¹
- **æ­£åˆ™åŒ–**: ä½¿ç”¨æ›´å¤§çš„alphaï¼ˆ10.0 vs 1.0ï¼‰é˜²æ­¢è¿‡æ‹Ÿåˆ

**ä¸æ ‡å‡†LRçš„åŒºåˆ«**:
- æ ‡å‡†LR: æ‰€æœ‰å˜é‡å…±äº«ä¸€ä¸ªæ¨¡å‹ï¼Œé¢„æµ‹æ‰€æœ‰å˜é‡çš„æ‰€æœ‰ç½‘æ ¼ç‚¹
- å¤šè¾“å‡ºLR: æ¯ä¸ªå˜é‡ç‹¬ç«‹æ¨¡å‹ï¼Œä½†è¾“å…¥åŒ…å«æ‰€æœ‰å˜é‡çš„ä¿¡æ¯

**é€‚ç”¨åœºæ™¯**:
- âœ… å¤šå˜é‡é¢„æµ‹ï¼ˆæ¯ä¸ªå˜é‡æœ‰ç‹¬ç«‹çš„ç‰©ç†ç‰¹æ€§ï¼‰
- âœ… éœ€è¦å˜é‡ç‰¹å®šæ­£åˆ™åŒ–çš„åœºæ™¯

---

### LSTM

#### æ¨¡å‹ç»“æ„

```
è¾“å…¥: (batch, 12, features)
  â†“
LSTMå±‚ (hidden_size=128, num_layers=2)
  â†“
å–æœ€åæ—¶é—´æ­¥çš„éšè—çŠ¶æ€: (batch, hidden_size)
  â†“
å…¨è¿æ¥å±‚: (batch, hidden_size) â†’ (batch, 4*features)
  â†“
é‡å¡‘: (batch, 4, features)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, input_size)`
  - `input_size`: å±•å¹³åçš„ç‰¹å¾æ•°ï¼ˆ`channels * H * W`ï¼‰
- **è¾“å‡º**: `(batch, output_length=4, input_size)`
- **å…³é”®å‚æ•°**:
  - `hidden_size`: LSTMéšè—å±‚ç»´åº¦ï¼ˆé»˜è®¤128ï¼‰
  - `num_layers`: LSTMå±‚æ•°ï¼ˆé»˜è®¤2ï¼‰
  - `dropout`: Dropoutç‡ï¼ˆé»˜è®¤0.2ï¼‰

#### å·¥ä½œåŸç†

1. **æ—¶é—´å»ºæ¨¡**: LSTMé€šè¿‡é—¨æ§æœºåˆ¶ï¼ˆé—å¿˜é—¨ã€è¾“å…¥é—¨ã€è¾“å‡ºé—¨ï¼‰å»ºæ¨¡æ—¶é—´ä¾èµ–
2. **è®°å¿†æœºåˆ¶**: ç»†èƒçŠ¶æ€ï¼ˆcell stateï¼‰å­˜å‚¨é•¿æœŸè®°å¿†
3. **åºåˆ—å¤„ç†**: é€æ—¶é—´æ­¥å¤„ç†ï¼Œä¿ç•™æ—¶é—´é¡ºåºä¿¡æ¯
4. **ç©ºé—´ä¿¡æ¯ä¸¢å¤±**: è¾“å…¥æ—¶å·²å°†ç©ºé—´ç»´åº¦å±•å¹³ï¼Œæ— æ³•åˆ©ç”¨ç©ºé—´ç»“æ„

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - æœ‰æ•ˆå»ºæ¨¡æ—¶é—´ä¾èµ–å…³ç³»
  - é€‚åˆå•ç‚¹æ—¶é—´åºåˆ—é¢„æµ‹
- **å±€é™**:
  - ä¸¢å¤±ç©ºé—´ç»“æ„ï¼ˆå±•å¹³æ“ä½œï¼‰
  - æ— æ³•æ•è·ç©ºé—´ç›¸å…³æ€§ï¼ˆå¦‚ç›¸é‚»ç½‘æ ¼çš„ç›¸ä¼¼æ€§ï¼‰
  - å‚æ•°é‡å¤§ï¼ˆå…¨è¿æ¥å±‚ï¼‰

#### é€‚ç”¨åœºæ™¯

- âœ… å•ç‚¹é¢„æµ‹ï¼ˆå¦‚å•ä¸ªæ°”è±¡ç«™ï¼‰
- âœ… ç‰¹å¾å·²æå–/é™ç»´çš„æƒ…å†µ
- âŒ ä¸é€‚åˆéœ€è¦ç©ºé—´ä¿¡æ¯çš„ç½‘æ ¼é¢„æµ‹

#### æ‰©å±•ï¼šå…¶ä»–LSTMå˜ä½“

`src/models/lstm.py` ä¸­è¿˜å®ç°äº†å…¶ä»–LSTMå˜ä½“ï¼š

1. **BidirectionalLSTM**:
   - åŒå‘LSTMï¼Œå¯ä»¥åŒæ—¶åˆ©ç”¨è¿‡å»å’Œæœªæ¥çš„ä¿¡æ¯
   - è¾“å‡ºç»´åº¦ä¸º `2 * hidden_size`
   - é€‚åˆç¼–ç å™¨åœºæ™¯ï¼Œä½†é¢„æµ‹ä»»åŠ¡ä¸­æ— æ³•ä½¿ç”¨æœªæ¥ä¿¡æ¯

2. **LSTMSeq2Seq**:
   - ç¼–ç å™¨-è§£ç å™¨æ¶æ„
   - ç¼–ç å™¨å¤„ç†è¾“å…¥åºåˆ—ï¼Œè§£ç å™¨è‡ªå›å½’ç”Ÿæˆè¾“å‡º
   - æ›´é€‚åˆåºåˆ—åˆ°åºåˆ—çš„é¢„æµ‹ä»»åŠ¡

---

### Transformer (åºåˆ—å»ºæ¨¡)

#### æ¨¡å‹ç»“æ„

æ ‡å‡†Transformeræ¨¡å‹ï¼ˆ`TransformerModel`ï¼‰ï¼š

```
è¾“å…¥: (batch, 12, features)
  â†“
è¾“å…¥æŠ•å½±: Linear(features, d_model=128)
  â†“
ä½ç½®ç¼–ç : PositionalEncoding (æ­£å¼¦ç¼–ç )
  â†“
Transformerç¼–ç å™¨ (3å±‚):
  MultiheadAttention (4 heads) â†’ LayerNorm â†’ FFN â†’ LayerNorm
  â†“
å–æœ€åæ—¶é—´æ­¥: (batch, d_model)
  â†“
è¾“å‡ºæŠ•å½±:
  LayerNorm â†’ Dropout â†’ Linear(d_model, d_model//2) â†’ ReLU â†’ 
  Dropout â†’ Linear(d_model//2, features*4)
  â†“
é‡å¡‘: (batch, 4, features)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, input_size)`
  - `input_size`: å±•å¹³åçš„ç‰¹å¾æ•°ï¼ˆ`channels * H * W`ï¼‰
- **è¾“å‡º**: `(batch, output_length=4, input_size)`
- **å…³é”®å‚æ•°**:
  - `d_model`: TransformeråµŒå…¥ç»´åº¦ï¼ˆé»˜è®¤128ï¼Œå·²ä¼˜åŒ–å‡å°ï¼‰
  - `nhead`: æ³¨æ„åŠ›å¤´æ•°ï¼ˆé»˜è®¤4ï¼Œå·²ä¼˜åŒ–å‡å°ï¼‰
  - `num_layers`: Transformerå±‚æ•°ï¼ˆé»˜è®¤3ï¼Œå·²ä¼˜åŒ–å‡å°ï¼‰
  - `dropout`: Dropoutç‡ï¼ˆé»˜è®¤0.2ï¼Œå·²ä¼˜åŒ–å¢åŠ ï¼‰

#### å·¥ä½œåŸç†

1. **æ³¨æ„åŠ›æœºåˆ¶**: ä½¿ç”¨å¤šå¤´è‡ªæ³¨æ„åŠ›æ•è·åºåˆ—å†…çš„ä¾èµ–å…³ç³»
2. **ä½ç½®ç¼–ç **: æ­£å¼¦ä½ç½®ç¼–ç æä¾›æ—¶é—´é¡ºåºä¿¡æ¯
3. **åºåˆ—å»ºæ¨¡**: Transformerç¼–ç å™¨å¤„ç†æ•´ä¸ªè¾“å…¥åºåˆ—
4. **ç©ºé—´ä¿¡æ¯ä¸¢å¤±**: è¾“å…¥æ—¶å·²å°†ç©ºé—´ç»´åº¦å±•å¹³ï¼Œæ— æ³•åˆ©ç”¨ç©ºé—´ç»“æ„
5. **ä¼˜åŒ–è®¾è®¡**: é’ˆå¯¹å•å˜é‡é¢„æµ‹åœºæ™¯ï¼Œå‡å°äº†å‚æ•°é‡ä»¥é˜²æ­¢è¿‡æ‹Ÿåˆ

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - æœ‰æ•ˆå»ºæ¨¡é•¿è·ç¦»æ—¶é—´ä¾èµ–ï¼ˆæ³¨æ„åŠ›æœºåˆ¶ï¼‰
  - å¹¶è¡Œè®¡ç®—ï¼Œè®­ç»ƒæ•ˆç‡é«˜
  - å‚æ•°é‡å·²ä¼˜åŒ–ï¼Œé€‚åˆå•å˜é‡é¢„æµ‹
- **å±€é™**:
  - âŒ **ä¸¢å¤±ç©ºé—´ç»“æ„**ï¼ˆå±•å¹³æ“ä½œï¼‰
  - âŒ æ— æ³•æ•è·ç©ºé—´ç›¸å…³æ€§
  - âŒ è®¡ç®—å¤æ‚åº¦O(nÂ²)ï¼Œåºåˆ—é•¿åº¦å—é™

#### é€‚ç”¨åœºæ™¯

- âœ… å•ç‚¹æ—¶é—´åºåˆ—é¢„æµ‹
- âœ… ç‰¹å¾å·²æå–/é™ç»´çš„æƒ…å†µ
- âœ… éœ€è¦æ•è·é•¿è·ç¦»æ—¶é—´ä¾èµ–çš„ä»»åŠ¡
- âŒ ä¸é€‚åˆéœ€è¦ç©ºé—´ä¿¡æ¯çš„ç½‘æ ¼é¢„æµ‹

#### æ‰©å±•ï¼šå…¶ä»–Transformerå˜ä½“

`src/models/transformer.py` ä¸­è¿˜å®ç°äº†å…¶ä»–Transformerå˜ä½“ï¼š

1. **TransformerSeq2Seq**:
   - ç¼–ç å™¨-è§£ç å™¨æ¶æ„
   - ç¼–ç å™¨å¤„ç†è¾“å…¥åºåˆ—ï¼Œè§£ç å™¨ä½¿ç”¨å¯å­¦ä¹ æŸ¥è¯¢tokenç”Ÿæˆè¾“å‡º
   - æ›´é€‚åˆåºåˆ—åˆ°åºåˆ—çš„é¢„æµ‹ä»»åŠ¡
   - å‚æ•°ï¼š`d_model=256, nhead=8, num_encoder_layers=4, num_decoder_layers=4`

2. **SpatialTransformer**:
   - å°†æ¯ä¸ªç©ºé—´ä½ç½®å½“ä½œä¸€ä¸ªtoken
   - ä½¿ç”¨Transformerå»ºæ¨¡ç©ºé—´ä½ç½®ä¹‹é—´çš„å…³ç³»
   - æ³¨æ„ï¼šå¯¹äºå¤§çš„ç©ºé—´ç½‘æ ¼ï¼ˆå¦‚32Ã—64=2048ä¸ªtokenï¼‰è®¡ç®—é‡å¾ˆå¤§
   - å½“å‰å®ç°ä¸­å¯èƒ½æœªä½¿ç”¨

---

### CNN

#### æ¨¡å‹ç»“æ„

```
è¾“å…¥: (batch, 12, channels, H, W)
  â†“
å±•å¹³æ—¶é—´ç»´åº¦: (batch, 12*channels, H, W)
  â†“
ç¼–ç å™¨ (Encoder):
  Conv2d(12*channels, 64, k=3, p=1) â†’ BN â†’ ReLU
  Conv2d(64, 128, k=3, p=1) â†’ BN â†’ ReLU
  Conv2d(128, 128, k=3, s=2, p=1) â†’ BN â†’ ReLU  # ä¸‹é‡‡æ ·: 64Ã—32 â†’ 32Ã—16
  Conv2d(128, 256, k=3, p=1) â†’ BN â†’ ReLU
  â†“
è§£ç å™¨ (Decoder):
  ConvTranspose2d(256, 128, k=4, s=2, p=1) â†’ BN â†’ ReLU  # ä¸Šé‡‡æ ·: 32Ã—16 â†’ 64Ã—32
  Conv2d(128, 64, k=3, p=1) â†’ BN â†’ ReLU
  Conv2d(64, 4*channels, k=3, p=1)  # è¾“å‡º
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, channels, H=32, W=64)`
- **è¾“å‡º**: `(batch, output_length=4, channels, H=32, W=64)`
- **å…³é”®å‚æ•°**:
  - `hidden_channels`: éšè—å±‚é€šé“æ•°ï¼ˆé»˜è®¤64ï¼‰
  - `input_channels`: è¾“å…¥å˜é‡æ•°

#### å·¥ä½œåŸç†

1. **ç©ºé—´ç‰¹å¾æå–**: å·ç§¯æ“ä½œæ•è·å±€éƒ¨ç©ºé—´æ¨¡å¼ï¼ˆå¦‚æ¸©åº¦æ¢¯åº¦ã€æ°”å‹ç³»ç»Ÿï¼‰
2. **å¤šå°ºåº¦è¡¨ç¤º**: é€šè¿‡ä¸‹é‡‡æ ·å’Œä¸Šé‡‡æ ·å­¦ä¹ ä¸åŒå°ºåº¦çš„ç‰¹å¾
3. **æ—¶é—´ä¿¡æ¯å¤„ç†**: å°†å¤šä¸ªæ—¶é—´æ­¥ä½œä¸ºå¤šé€šé“è¾“å…¥ï¼Œä½†**ä¸æ˜¾å¼å»ºæ¨¡æ—¶é—´ä¾èµ–**
4. **ç©ºé—´ç»“æ„ä¿ç•™**: ä¿æŒç©ºé—´ç»´åº¦ï¼Œåˆ©ç”¨ç›¸é‚»ç½‘æ ¼çš„ç›¸å…³æ€§

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - æœ‰æ•ˆæå–ç©ºé—´ç‰¹å¾ï¼ˆå¦‚é”‹é¢ã€æ°”æ—‹ï¼‰
  - è®¡ç®—æ•ˆç‡é«˜ï¼ˆå·ç§¯æ“ä½œï¼‰
  - å‚æ•°é‡ç›¸å¯¹è¾ƒå°‘
- **å±€é™**:
  - **æ— æ—¶åºå»ºæ¨¡**: å°†æ—¶é—´æ­¥å½“ä½œé€šé“ï¼Œæ— æ³•å­¦ä¹ æ—¶é—´æ¼”åŒ–è§„å¾‹
  - æ— æ³•æ•è·é•¿æœŸæ—¶é—´ä¾èµ–

#### é€‚ç”¨åœºæ™¯

- âœ… ç©ºé—´æ¨¡å¼é¢„æµ‹ï¼ˆå¦‚é™æ€å¤©æ°”å›¾ï¼‰
- âœ… è®¡ç®—èµ„æºæœ‰é™çš„æƒ…å†µ
- âŒ ä¸é€‚åˆéœ€è¦æ—¶é—´ä¾èµ–çš„é¢„æµ‹ä»»åŠ¡

#### æ‰©å±•ï¼šDeepCNN

`src/models/cnn.py` ä¸­è¿˜å®ç°äº† `DeepCNN`ï¼š

- **æ®‹å·®è¿æ¥**: ä½¿ç”¨ResidualBlockæ„å»ºæ›´æ·±çš„ç½‘ç»œ
- **ç»“æ„**: è¾“å…¥æŠ•å½± â†’ å¤šä¸ªæ®‹å·®å— â†’ è¾“å‡ºæŠ•å½±
- **ä¼˜åŠ¿**: æ›´æ·±çš„ç½‘ç»œå¯ä»¥å­¦ä¹ æ›´å¤æ‚çš„ç©ºé—´æ¨¡å¼
- **å‚æ•°**: `n_residual_blocks` æ§åˆ¶æ®‹å·®å—æ•°é‡ï¼ˆé»˜è®¤3ï¼‰

---

### ConvLSTM

#### æ¨¡å‹ç»“æ„

```
è¾“å…¥: (batch, 12, channels, H, W)
  â†“
ConvLSTMç¼–ç å™¨ (å¤šå±‚):
  ConvLSTMCell: å·ç§¯LSTMå•å…ƒ
    - è¾“å…¥é—¨ (i): æ§åˆ¶æ–°ä¿¡æ¯æµå…¥
    - é—å¿˜é—¨ (f): æ§åˆ¶æ—§ä¿¡æ¯é—å¿˜
    - ç»†èƒé—¨ (g): å€™é€‰å€¼
    - è¾“å‡ºé—¨ (o): æ§åˆ¶è¾“å‡º
    - æ‰€æœ‰æ“ä½œéƒ½æ˜¯å·ç§¯è€Œéå…¨è¿æ¥
  â†“
å–æœ€åä¸€å±‚çš„æœ€åæ—¶é—´æ­¥: (batch, hidden_channels, H, W)
  â†“
è¾“å‡ºæŠ•å½±:
  Conv2d(hidden_channels, hidden_channels//2)
  Conv2d(hidden_channels//2, 4*channels)
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

#### ConvLSTMå•å…ƒè¯¦è§£

```python
# ConvLSTMCell æ ¸å¿ƒæ“ä½œ
combined = concat([input, hidden_state])  # (B, C_in+C_hid, H, W)
gates = Conv2d(combined) â†’ (B, 4*C_hid, H, W)  # i, f, g, o
i, f, g, o = split(gates)

cell_next = f * cell + i * g  # æ›´æ–°ç»†èƒçŠ¶æ€
hidden_next = o * tanh(cell_next)  # æ›´æ–°éšè—çŠ¶æ€
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, input_channels, H=32, W=64)`
- **è¾“å‡º**: `(batch, output_length=4, input_channels, H=32, W=64)`
- **å…³é”®å‚æ•°**:
  - `hidden_channels`: ConvLSTMéšè—é€šé“æ•°ï¼ˆé»˜è®¤64ï¼‰
  - `num_layers`: ConvLSTMå±‚æ•°ï¼ˆé»˜è®¤2ï¼‰
  - `kernel_size`: å·ç§¯æ ¸å¤§å°ï¼ˆé»˜è®¤3ï¼‰

#### å·¥ä½œåŸç†

1. **æ—¶ç©ºè”åˆå»ºæ¨¡**: 
   - **æ—¶é—´ç»´åº¦**: LSTMçš„é—¨æ§æœºåˆ¶å»ºæ¨¡æ—¶é—´ä¾èµ–
   - **ç©ºé—´ç»´åº¦**: å·ç§¯æ“ä½œä¿ç•™ç©ºé—´ç»“æ„
   
2. **è®°å¿†æœºåˆ¶**: 
   - ç»†èƒçŠ¶æ€å­˜å‚¨é•¿æœŸæ—¶ç©ºè®°å¿†
   - éšè—çŠ¶æ€ç¼–ç å½“å‰æ—¶ç©ºç‰¹å¾

3. **å¤šå°ºåº¦ç‰¹å¾**: 
   - å¤šå±‚ConvLSTMå­¦ä¹ ä¸åŒæŠ½è±¡å±‚æ¬¡çš„ç‰¹å¾
   - åº•å±‚æ•è·å±€éƒ¨æ¨¡å¼ï¼Œé«˜å±‚æ•è·å…¨å±€æ¨¡å¼

4. **ç©ºé—´ç›¸å…³æ€§**: 
   - å·ç§¯æ“ä½œè‡ªåŠ¨æ•è·ç›¸é‚»ç½‘æ ¼çš„ç›¸å…³æ€§
   - æ— éœ€æ‰‹åŠ¨è®¾è®¡ç©ºé—´ä¾èµ–

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… **åŒæ—¶å»ºæ¨¡æ—¶ç©ºä¾èµ–**ï¼Œæœ€é€‚åˆå¤©æ°”é¢„æµ‹ä»»åŠ¡
  - âœ… ä¿ç•™ç©ºé—´ç»“æ„ï¼Œå……åˆ†åˆ©ç”¨ç½‘æ ¼æ•°æ®
  - âœ… è®°å¿†æœºåˆ¶é€‚åˆæ•è·å¤©æ°”ç³»ç»Ÿçš„æ¼”åŒ–è§„å¾‹
  - âœ… åœ¨ç¡®å®šæ€§æ¨¡å‹ä¸­è¡¨ç°æœ€ä½³

- **å±€é™**:
  - å‚æ•°é‡è¾ƒå¤§
  - è®­ç»ƒæ—¶é—´è¾ƒé•¿
  - æ— æ³•é‡åŒ–ä¸ç¡®å®šæ€§

#### é€‚ç”¨åœºæ™¯

- âœ… **é€šç”¨å¤©æ°”é¢„æµ‹**ï¼ˆæ¨èï¼‰
- âœ… éœ€è¦æ—¶ç©ºå»ºæ¨¡çš„ä»»åŠ¡
- âœ… ç¡®å®šæ€§é¢„æµ‹åœºæ™¯

#### æ‰©å±•ï¼šConvLSTM Seq2Seq

`src/models/convlstm.py` ä¸­è¿˜å®ç°äº† `ConvLSTMSeq2Seq`ï¼š

**æ¨¡å‹ç»“æ„**:
```
è¾“å…¥: (batch, 12, channels, H, W)
  â†“
ç¼–ç å™¨ (ConvLSTMå¤šå±‚):
  å¤„ç†è¾“å…¥åºåˆ—ï¼Œæå–å†å²æ—¶ç©ºç‰¹å¾
  â†“
å–æœ€åä¸€å±‚çš„æœ€åçŠ¶æ€: (h, c)
  â†“
è§£ç å™¨ (è‡ªå›å½’):
  for t in range(output_length):
    decoder_input = æœ€åä¸€å¸§ (æˆ–ä¸Šä¸€æ­¥é¢„æµ‹)
    h, c = ConvLSTMCell(decoder_input, (h, c))
    out = Conv2d(h) â†’ (batch, channels, H, W)
    ä½¿ç”¨outä½œä¸ºä¸‹ä¸€æ­¥çš„decoder_input
  â†“
è¾“å‡º: (batch, 4, channels, H, W)
```

**ç‰¹ç‚¹**:
- ç¼–ç å™¨-è§£ç å™¨æ¶æ„ï¼Œæ›´é€‚åˆåºåˆ—åˆ°åºåˆ—ä»»åŠ¡
- è‡ªå›å½’ç”Ÿæˆï¼šä½¿ç”¨é¢„æµ‹ä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥ï¼ˆè‡ªç”±è¿è¡Œæ¨¡å¼ï¼‰
- å¯é€‰æ•™å¸ˆå¼ºåˆ¶ï¼šè®­ç»ƒæ—¶å¯ä»¥ä½¿ç”¨çœŸå®å€¼ä½œä¸ºä¸‹ä¸€æ­¥è¾“å…¥
- é€‚åˆéœ€è¦æ›´é•¿è¾“å‡ºåºåˆ—æˆ–å¸Œæœ›åœ¨è§£ç é˜¶æ®µæ³¨å…¥å¤–éƒ¨æ¡ä»¶çš„åœºæ™¯

---

### Weather Transformer

#### æ¨¡å‹ç»“æ„

```
è¾“å…¥: (batch, 12, channels, H, W)
  â†“
Patch Embedding (æ¯ä¸ªæ—¶é—´æ­¥):
  Conv2d(C, embed_dim, kernel=patch_size, stride=patch_size)
  (32, 64) â†’ (8, 8) patches, æ¯ä¸ªpatch 4Ã—8
  â†“
ä½ç½®ç¼–ç :
  - æ—¶é—´ä½ç½®ç¼–ç : æ­£å¼¦ç¼–ç ï¼ˆå¤–æ¨èƒ½åŠ›å¼ºï¼‰
  - ç©ºé—´ä½ç½®ç¼–ç : å¯å­¦ä¹ å‚æ•°
  â†“
æ—¶ç©ºæ³¨æ„åŠ›ç¼–ç å™¨ (Encoder):
  Spatial Attention: åŒä¸€æ—¶é—´æ­¥å†…ï¼Œpatchesä¹‹é—´çš„æ³¨æ„åŠ›
  Temporal Attention: åŒä¸€patchï¼Œè·¨æ—¶é—´æ­¥çš„æ³¨æ„åŠ›
  Factorizedè®¾è®¡: O(T*NÂ² + N*TÂ²) vs O((T*N)Â²)
  â†“
å¯å­¦ä¹ è¾“å‡ºæŸ¥è¯¢ (Learnable Queries):
  (batch, 4, 8*8, embed_dim)  # æœªæ¥4ä¸ªæ—¶é—´æ­¥çš„æŸ¥è¯¢
  â†“
è§£ç å™¨ (Decoder):
  æµ…å±‚Transformerè§£ç å™¨
  â†“
è¾“å‡ºæŠ•å½±:
  Linear(embed_dim, patch_sizeÂ² * channels)
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, input_channels, H=32, W=64)`
- **è¾“å‡º**: `(batch, output_length=4, input_channels, H=32, W=64)`
- **å…³é”®å‚æ•°**:
  - `d_model`: æ¨¡å‹ç»´åº¦ï¼ˆé»˜è®¤128ï¼‰
  - `n_heads`: æ³¨æ„åŠ›å¤´æ•°ï¼ˆé»˜è®¤4ï¼‰
  - `n_layers`: Encoderå±‚æ•°ï¼ˆé»˜è®¤4ï¼‰
  - `patch_size`: Patchå¤§å°ï¼ˆé»˜è®¤(4, 8)ï¼‰

#### å·¥ä½œåŸç†

1. **Patch-basedå¤„ç†**:
   - å°†ç©ºé—´ç½‘æ ¼åˆ†å‰²ä¸ºpatchesï¼ˆç±»ä¼¼ViTï¼‰
   - æ¯ä¸ªpatchä½œä¸ºä¸€ä¸ªtoken
   - å‡å°‘è®¡ç®—å¤æ‚åº¦

2. **Factorizedæ—¶ç©ºæ³¨æ„åŠ›**:
   - **Spatial Attention**: åŒä¸€æ—¶é—´æ­¥å†…ï¼Œpatchesä¹‹é—´çš„æ³¨æ„åŠ›
     - æ•è·ç©ºé—´ç›¸å…³æ€§ï¼ˆå¦‚ç›¸é‚»åŒºåŸŸçš„ç›¸ä¼¼æ€§ï¼‰
   - **Temporal Attention**: åŒä¸€patchï¼Œè·¨æ—¶é—´æ­¥çš„æ³¨æ„åŠ›
     - æ•è·æ—¶é—´æ¼”åŒ–è§„å¾‹
   - **ä¼˜åŠ¿**: è®¡ç®—å¤æ‚åº¦ä»O((T*N)Â²)é™ä½åˆ°O(T*NÂ² + N*TÂ²)

3. **ä½ç½®ç¼–ç **:
   - æ—¶é—´ä½ç½®ç¼–ç ï¼šæ­£å¼¦ç¼–ç ï¼ˆæ›´å¥½çš„å¤–æ¨èƒ½åŠ›ï¼‰
   - ç©ºé—´ä½ç½®ç¼–ç ï¼šå¯å­¦ä¹ å‚æ•°ï¼ˆé€‚é…ä¸è§„åˆ™åœ°çƒç½‘æ ¼ï¼‰

4. **è½»é‡åŒ–è®¾è®¡**:
   - å‚æ•°é‡çº¦1.6Mï¼ˆä¸ConvLSTMç›¸å½“ï¼‰
   - ä½¿ç”¨æ®‹å·®åLayerNorm (Post-LN) ä¸æ›´å¥½çš„åˆå§‹åŒ–

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… æ•è·é•¿è·ç¦»æ—¶ç©ºä¾èµ–ï¼ˆæ³¨æ„åŠ›æœºåˆ¶ï¼‰
  - âœ… è½»é‡çº§è®¾è®¡ï¼Œå‚æ•°é‡å°‘
  - âœ… é€‚åˆæ•è·å¤§å°ºåº¦å¤©æ°”ç³»ç»Ÿï¼ˆå¦‚å…¨çƒç¯æµï¼‰

- **å±€é™**:
  - Patchåˆ†å‰²å¯èƒ½ä¸¢å¤±ç»†èŠ‚
  - è®­ç»ƒéœ€è¦æ›´å¤šæ•°æ®
  - è®¡ç®—å¤æ‚åº¦ä»è¾ƒé«˜

#### é€‚ç”¨åœºæ™¯

- âœ… éœ€è¦æ•è·é•¿è·ç¦»ä¾èµ–çš„ä»»åŠ¡
- âœ… å¤§å°ºåº¦å¤©æ°”ç³»ç»Ÿé¢„æµ‹
- âœ… è®¡ç®—èµ„æºå……è¶³çš„æƒ…å†µ

---

## WeatherDiff æ¨¡å—

WeatherDiffæ˜¯åŸºäºStable Diffusionæ¶æ„çš„å¤©æ°”é¢„æµ‹æ¨¡å—ï¼Œå°†æ°”è±¡ç½‘æ ¼æ•°æ®è§†ä¸ºå›¾åƒï¼Œåˆ©ç”¨é¢„è®­ç»ƒVAEå’ŒU-Netæ¶æ„è¿›è¡Œæ—¶ç©ºé¢„æµ‹ã€‚

### æ ¸å¿ƒæ€æƒ³

1. **å›¾åƒåŒ–å¤„ç†**: å°†å¤©æ°”åœºè§†ä¸ºå›¾åƒï¼ˆæ¯ä¸ªæ—¶é—´æ­¥æ˜¯ä¸€å¸§ï¼‰
2. **VAEå‹ç¼©**: ä½¿ç”¨é¢„è®­ç»ƒVAEå°†é«˜ç»´å›¾åƒå‹ç¼©åˆ°ä½ç»´æ½œç©ºé—´
3. **æ½œç©ºé—´é¢„æµ‹**: åœ¨æ½œç©ºé—´ä¸­é¢„æµ‹ï¼Œé™ä½è®¡ç®—å¤æ‚åº¦
4. **æ¦‚ç‡å»ºæ¨¡**: Diffusionæ¨¡å‹æ”¯æŒä¸ç¡®å®šæ€§é‡åŒ–

---

### VAE (Stable Diffusion VAE)

#### æ¨¡å‹ç»“æ„

```
ç¼–ç å™¨ (Encoder):
  è¾“å…¥å›¾åƒ: (B, C, H, W)  # èŒƒå›´[-1, 1]
    â†“
  å·ç§¯ä¸‹é‡‡æ ·: H, W â†’ H//8, W//8
    â†“
  æ½œå‘é‡: (B, 4, H//8, W//8)  # å‹ç¼©æ¯” 8Ã—8 = 64å€

è§£ç å™¨ (Decoder):
  æ½œå‘é‡: (B, 4, H//8, W//8)
    â†“
  å·ç§¯ä¸Šé‡‡æ ·: H//8, W//8 â†’ H, W
    â†“
  é‡å»ºå›¾åƒ: (B, C, H, W)  # èŒƒå›´[-1, 1]
```

#### è¾“å…¥è¾“å‡º

- **ç¼–ç **:
  - **è¾“å…¥**: `(batch, channels, H, W)` - èŒƒå›´[-1, 1]
  - **è¾“å‡º**: `(batch, 4, H//8, W//8)` - æ½œå‘é‡
  
- **è§£ç **:
  - **è¾“å…¥**: `(batch, 4, H//8, W//8)` - æ½œå‘é‡
  - **è¾“å‡º**: `(batch, channels, H, W)` - èŒƒå›´[-1, 1]

#### è®­ç»ƒç­–ç•¥

å½“å‰å®ç°ä»…æ”¯æŒåŠ è½½Stable Diffusioné¢„è®­ç»ƒVAEæƒé‡ï¼ˆé»˜è®¤ä»HuggingFaceè·å–ï¼Œå¯é€šè¿‡
`--vae-pretrained-path` æŒ‡å®šè‡ªå®šä¹‰æƒé‡ï¼‰ã€‚å¯åˆ†åˆ«æ§åˆ¶encoder/decoderæ˜¯å¦å‚ä¸è®­ç»ƒï¼š

- `--freeze-encoder`: å†»ç»“encoderï¼Œä»…è®­ç»ƒdecoder+U-Net
- `--freeze-decoder`: å†»ç»“decoderï¼Œä»…è®­ç»ƒencoder+U-Net
- ä¸¤è€…éƒ½åŠ ï¼šå®Œå…¨å†»ç»“VAEï¼Œåªè®­ç»ƒU-Net
- ä¸åŠ ï¼šencoder/decoderä¸U-Netä¸€åŒå¾®è°ƒ

#### å·¥ä½œåŸç†

1. **é¢„è®­ç»ƒæ¨¡å‹**: ä½¿ç”¨Stable Diffusionçš„é¢„è®­ç»ƒVAEï¼ˆåœ¨è‡ªç„¶å›¾åƒä¸Šè®­ç»ƒï¼‰
2. **å‹ç¼©è¡¨ç¤º**: å°†512Ã—512å›¾åƒå‹ç¼©åˆ°64Ã—64æ½œç©ºé—´ï¼ˆå‹ç¼©æ¯”64å€ï¼‰
3. **è¯­ä¹‰ä¿æŒ**: æ½œç©ºé—´ä¿ç•™å›¾åƒçš„è¯­ä¹‰ä¿¡æ¯ï¼Œé€‚åˆç”Ÿæˆä»»åŠ¡
4. **é‡å»ºè¯¯å·®**: å¯¹äºå¤©æ°”æ•°æ®ï¼Œé‡å»ºRMSEçº¦5-10Kï¼ˆæ¸©åº¦å•ä½ï¼‰
5. **å¯è®­ç»ƒæ€§**: æ”¯æŒå†»ç»“VAEï¼ˆä»…æ¨ç†ï¼‰æˆ–è®­ç»ƒVAEï¼ˆå¾®è°ƒï¼‰

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… å¤§å¹…é™ä½è®¡ç®—å¤æ‚åº¦ï¼ˆ64å€å‹ç¼©ï¼‰
  - âœ… é¢„è®­ç»ƒæ¨¡å‹ï¼Œæ— éœ€ä»å¤´è®­ç»ƒ
  - âœ… æ½œç©ºé—´æ›´é€‚åˆç”Ÿæˆä»»åŠ¡
  - âœ… é€šè¿‡å†»ç»“å¼€å…³çµæ´»æ§åˆ¶VAEå¾®è°ƒèŒƒå›´

- **å±€é™**:
  - âŒ é‡å»ºè¯¯å·®è¾ƒå¤§ï¼ˆ5-10Kï¼‰ï¼Œå¯èƒ½ä¸¢å¤±ç»†èŠ‚
  - âŒ é¢„è®­ç»ƒåœ¨è‡ªç„¶å›¾åƒä¸Šï¼Œå¯èƒ½ä¸é€‚åˆå¤©æ°”æ•°æ®ï¼ˆå¯é€šè¿‡å¾®è°ƒæ”¹å–„ï¼‰
  - âŒ éœ€è¦æ•°æ®å½’ä¸€åŒ–åˆ°[-1, 1]

#### é€‚ç”¨åœºæ™¯

- âœ… å¤§å°ºå¯¸å›¾åƒé¢„æµ‹ï¼ˆ512Ã—512åŠä»¥ä¸Šï¼‰
- âœ… éœ€è¦é™ä½æ˜¾å­˜å’Œè®¡ç®—é‡çš„åœºæ™¯
- âœ… éœ€è¦é’ˆå¯¹å¤©æ°”æ•°æ®å¾®è°ƒVAE encoder/decoderçš„åœºæ™¯
- âŒ ä¸é€‚åˆéœ€è¦é«˜ç²¾åº¦é‡å»ºçš„ä»»åŠ¡

---

### RAE (Representation Autoencoder)

**å½“å‰å·¥ç¨‹ä¸­ä¸»è¦ç”¨åˆ°ä¸¤ç§æ¨¡å¼ï¼š**

1. **Stage-Aï¼ˆRAE é‡å»ºï¼‰**ï¼šåªçœ‹ Encoder + Decoderï¼Œå¯¹æœªæ¥å¤©æ°”åœºåšé‡å»ºã€‚
2. **Stage-1 Directï¼ˆç›´æ¥é¢„æµ‹ï¼‰**ï¼šç”¨å†å²åºåˆ—é€šè¿‡ Encoder â†’ Decoder ç›´æ¥é¢„æµ‹æœªæ¥å¤©æ°”åœºï¼ˆä¸ç»è¿‡ DiTï¼‰ã€‚


#### RAE é‡å»ºæ¨¡å‹ç»“æ„

```
ç¼–ç å™¨ (Encoder):
  è¾“å…¥å›¾åƒ: (B, C, H, W)  # èŒƒå›´[0, 1]ï¼Œè‡ªåŠ¨ä»[-1, 1]è½¬æ¢
    â†“
  Resizeåˆ°encoder_input_size (å¦‚256Ã—256)
    â†“
  Vision Transformer (DINOv2/SigLIP2/MAE)
    â†“
  æ½œå‘é‡: (B, latent_dim, H_latent, W_latent)
    # latent_dimå–å†³äºencoderï¼ˆå¦‚768 for DINOv2-baseï¼‰
    # H_latent, W_latent = encoder_input_size // patch_size

è§£ç å™¨ (Decoder):
  æ½œå‘é‡: (B, latent_dim, H_latent, W_latent)
    â†“
  Vision Transformer Decoder (MAE-based)
    â†“
  é‡å»ºå›¾åƒ: (B, C, H, W)  # èŒƒå›´[0, 1]ï¼Œè‡ªåŠ¨è½¬æ¢ä¸º[-1, 1]
```

#### è¾“å…¥è¾“å‡º

- **ç¼–ç **:
  - **è¾“å…¥**: `(batch, channels, H, W)` - èŒƒå›´[-1, 1]ï¼ˆè‡ªåŠ¨è½¬æ¢ä¸º[0, 1]ï¼‰
  - **è¾“å‡º**: `(batch, latent_dim, H_latent, W_latent)` - æ½œå‘é‡
    - `latent_dim`: å–å†³äºencoderï¼ˆDINOv2-base: 768, SigLIP2-base: 768ï¼‰
    - `H_latent, W_latent`: å–å†³äºencoderè¾“å…¥å°ºå¯¸å’Œpatchå¤§å°
  
- **è§£ç **:
  - **è¾“å…¥**: `(batch, latent_dim, H_latent, W_latent)` - æ½œå‘é‡
  - **è¾“å‡º**: `(batch, channels, H, W)` - èŒƒå›´[-1, 1]ï¼ˆè‡ªåŠ¨ä»[0, 1]è½¬æ¢ï¼‰
 


#### æ”¯æŒçš„Encoderç±»å‹

1. **DINOv2** (`Dinov2withNorm`):
   - é…ç½®è·¯å¾„: `facebook/dinov2-base`
   - è¾“å…¥å°ºå¯¸: 224Ã—224ï¼ˆé»˜è®¤ï¼‰
   - Latentç»´åº¦: 768
   - Latentç©ºé—´: 14Ã—14 (224/16=14)

2. **SigLIP2** (`SigLIP2wNorm`) â­ **æ¨è**:
   - é…ç½®è·¯å¾„: `google/siglip2-base-patch16-256`
   - è¾“å…¥å°ºå¯¸: 256Ã—256ï¼ˆé»˜è®¤ï¼‰
   - Latentç»´åº¦: 768
   - Latentç©ºé—´: 16Ã—16 (256/16=16)
   - **ä¼˜åŠ¿**: æ›´å¤§çš„è¾“å…¥å°ºå¯¸ï¼Œæ›´å¥½çš„ç©ºé—´åˆ†è¾¨ç‡

3. **MAE** (`MAEwNorm`):
   - é…ç½®è·¯å¾„: `facebook/vit-mae-base`
   - è¾“å…¥å°ºå¯¸: 224Ã—224
   - Latentç»´åº¦: 768
   - Latentç©ºé—´: 14Ã—14

#### å·¥ä½œåŸç†

1. **Encoderå›ºå®š**: Encoderå‚æ•°å›ºå®šï¼Œä¸å‚ä¸è®­ç»ƒï¼ˆ`freeze_encoder=True`ï¼‰
2. **Decoderå¯å¾®è°ƒ**: Decoderå‚æ•°å¯è®­ç»ƒï¼ˆ`freeze_decoder=False`ï¼‰ï¼Œæ”¯æŒå¾®è°ƒ
3. **è‡ªåŠ¨èŒƒå›´è½¬æ¢**: 
   - è¾“å…¥: [-1, 1] â†’ [0, 1]ï¼ˆRAEå†…éƒ¨ä½¿ç”¨ï¼‰
   - è¾“å‡º: [0, 1] â†’ [-1, 1]ï¼ˆåŒ¹é…Weatheré¡¹ç›®ï¼‰
4. **çµæ´»é…ç½®**: æ”¯æŒå¤šç§encoderç±»å‹ï¼Œå¯æ ¹æ®éœ€æ±‚é€‰æ‹©

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… **Decoderå¯å¾®è°ƒ**: ç›¸æ¯”SD VAEï¼ŒRAEçš„decoderå¯ä»¥é’ˆå¯¹å¤©æ°”æ•°æ®å¾®è°ƒ
  - âœ… **å¤šç§encoderé€‰æ‹©**: æ”¯æŒDINOv2ã€SigLIP2ã€MAEç­‰é¢„è®­ç»ƒencoder
  - âœ… **æ›´å¤§çš„latentç»´åº¦**: 768ç»´ï¼ˆvs SD VAEçš„4ç»´ï¼‰ï¼Œå¯èƒ½ä¿ç•™æ›´å¤šä¿¡æ¯
  - âœ… **è‡ªåŠ¨èŒƒå›´è½¬æ¢**: æ— éœ€æ‰‹åŠ¨å¤„ç†æ•°æ®èŒƒå›´

- **å±€é™**:
  - âŒ Encoderéœ€è¦resizeè¾“å…¥å›¾åƒï¼ˆå¯èƒ½ä¸¢å¤±ç»†èŠ‚ï¼‰
  - âŒ Latentç»´åº¦æ›´å¤§ï¼Œå¯èƒ½å¢åŠ è®¡ç®—é‡
  - âŒ éœ€è¦é¢å¤–çš„decoderè®­ç»ƒ

#### é€‚ç”¨åœºæ™¯

- âœ… éœ€è¦å¯å¾®è°ƒdecoderçš„åœºæ™¯
- âœ… å¸Œæœ›åˆ©ç”¨ä¸åŒé¢„è®­ç»ƒencoderçš„ç‰¹å¾
- âœ… å¤§å°ºå¯¸å›¾åƒé¢„æµ‹ï¼ˆ512Ã—512åŠä»¥ä¸Šï¼‰
- âœ… æ˜¾å­˜å……è¶³çš„æƒ…å†µï¼ˆlatentç»´åº¦è¾ƒå¤§ï¼‰

#### ä¸SD VAEçš„åŒºåˆ«

| ç‰¹æ€§ | SD VAE | RAE |
|------|--------|-----|
| Latent channels | 4 | å–å†³äºencoderï¼ˆå¦‚768ï¼‰ |
| Latent shape | (4, H//8, W//8) | (latent_dim, H_latent, W_latent) |
| Encoder | å›ºå®š | å›ºå®šï¼ˆå¯é…ç½®ï¼‰ |
| Decoder | å›ºå®š | **å¯å¾®è°ƒ** â­ |
| è¾“å…¥èŒƒå›´ | [-1, 1] | [-1, 1]ï¼ˆå†…éƒ¨è½¬æ¢ï¼‰ |
| è¾“å‡ºèŒƒå›´ | [-1, 1] | [-1, 1]ï¼ˆå†…éƒ¨è½¬æ¢ï¼‰ |
| è¾“å…¥resize | æ—  | æœ‰ï¼ˆåˆ°encoder_input_sizeï¼‰ |

#### ä½¿ç”¨ç¤ºä¾‹

```python
from weatherdiff.vae import RAEWrapper

vae_wrapper = RAEWrapper(
    encoder_cls='SigLIP2wNorm',
    encoder_config_path='google/siglip2-base-patch16-256',
    encoder_input_size=256,
    decoder_config_path='vit_mae-base',
    decoder_patch_size=16,
    device='cuda',
    freeze_encoder=True,
    freeze_decoder=False  # decoderå¯å¾®è°ƒ
)

# ç¼–ç 
latent = vae_wrapper.encode(images)  # (B, 768, 16, 16)

# è§£ç 
reconstructed = vae_wrapper.decode(latent)  # (B, C, H, W)
```

#### Encoder+Decoderç›´æ¥é¢„æµ‹æ¨¡å‹ç»“æ„
```
å†å²ç¼–ç å™¨ (ExternalRepEncoder for history):
  è¾“å…¥å†å²åºåˆ—: (B, T_in, C_in, H, W)
    â†“
  æ—¶é—´ + é€šé“æ‹¼æ¥: (B, T_in * C_in, H, W)
    â†“
  1Ã—1å·ç§¯ in_adapter: (T_in*C_in) â†’ 3é€šé“
    â†“
  Resize åˆ° encoder_input_size (å¦‚ 518Ã—518)
    â†“
  é¢„è®­ç»ƒ Vision Transformer ä¸»å¹² (DINOv2 / MAE / SigLIP2)
    â†“
  History tokens:
    (B, latent_dim, H_latent, W_latent)

RAE è§£ç å™¨ (RAEDecoder):
  History tokens: (B, latent_dim, H_latent, W_latent)
    â†“
  RAEDecoder ç›´æ¥é¢„æµ‹æœªæ¥:
    â†“
  é¢„æµ‹æœªæ¥å¤©æ°”åœº: (B, T_out, C_out, H, W)
    # ä¾‹å¦‚ï¼šä» 12 æ­¥å†å² â†’ 4 æ­¥æœªæ¥ 2m_temperature
```

#### è¾“å…¥è¾“å‡º

- **ç¼–ç **:
  - **è¾“å…¥**: `(B, T_in, C_in, H, W)` - x_hist
  - **è¾“å‡º**: `(B, latent_dim, H_latent, W_latent)` - tokens_hist
    - `latent_dim`: å–å†³äºencoderï¼ˆDINOv2-base: 768, SigLIP2-base: 768ï¼‰
    - `H_latent, W_latent`: å–å†³äºencoderè¾“å…¥å°ºå¯¸å’Œpatchå¤§å°
  
- **è§£ç **:
  - **è¾“å…¥**: `(B, latent_dim, H_latent, W_latent)` - tokens_hist
  - **è¾“å‡º**: `(B, T_out, C_out, H, W)` - y_pred
---

#### æ”¯æŒçš„ Encoder ç±»å‹ï¼ˆç¤ºä¾‹ï¼‰

1.  **DINOv2-G/14**ï¼ˆå½“å‰å®éªŒä¸­ä½¿ç”¨ï¼‰
    
    -   `timm` åç§°: `vit_giant_patch14_dinov2`
        
    -   è¾“å…¥å°ºå¯¸: 518Ã—518
        
    -   Patch size: 14
        
    -   Latentç»´åº¦: 1536
        
    -   Latentç©ºé—´: 37Ã—37
        
2.  **DINOv2-Base/16**
    
    -   `facebook/dinov2-base`
        
    -   è¾“å…¥å°ºå¯¸: 224Ã—224
        
    -   Patch size: 16
        
    -   Latentç»´åº¦: 768
        
    -   Latentç©ºé—´: 14Ã—14
        
3.  **SigLIP2 / MAE / å…¶ä»– ViT**
    
    -   é€šè¿‡ä¿®æ”¹ `timm.create_model` åç§°å³å¯åˆ‡æ¢ï¼›
        
    -   å¤–éƒ¨ç»“æ„ï¼ˆin\_adapter â†’ ViT â†’ RAEDecoderï¼‰ä¿æŒä¸å˜ã€‚
        

---

#### å·¥ä½œåŸç†ï¼ˆé’ˆå¯¹å½“å‰å·¥ç¨‹ï¼‰

1.  **Encoder ä¸»å¹²å†»ç»“ï¼Œåªè®­ç»ƒ in\_adapterï¼ˆå¯é€‰ï¼‰**
    
    -   DINOv2 backbone å‚æ•°å›ºå®š (`freeze_backbone=True`)ï¼›
        
    -   1Ã—1 in\_adapter å¯ä»¥é€‰æ‹©è®­ç»ƒæˆ–å†»ç»“ï¼Œç”¨äºæŠŠæ°”è±¡åœºæ˜ å°„åˆ° encoder æœŸæœ›çš„åˆ†å¸ƒç©ºé—´ã€‚
        
2.  **RAEDecoder å¯å¾®è°ƒ**
    
    -   Decoder æƒé‡ä» RAE é¢„è®­ç»ƒæƒé‡åŠ è½½ï¼ˆæˆ–éšæœºåˆå§‹åŒ–ï¼‰ï¼Œåœ¨å¤©æ°”ä»»åŠ¡ä¸Šç»§ç»­è®­ç»ƒï¼›
        
    -   Stage-Aï¼šå­¦ä¹ ã€Œæœªæ¥ â†’ æ½œç©ºé—´ â†’ é‡å»ºæœªæ¥ã€çš„æ˜ å°„ï¼›
        
    -   Stage-1ï¼šå­¦ä¹ ã€Œå†å² â†’ æ½œç©ºé—´ â†’ é¢„æµ‹æœªæ¥ã€çš„æ˜ å°„ã€‚
        
3.  **è‡ªåŠ¨ resize / æ’å€¼**
    
    -   è¾“å…¥ ERA5 ç½‘æ ¼è¾ƒå°ï¼ˆ64Ã—32ï¼‰ï¼›
        
    -   ExternalRepEncoder å†…éƒ¨ç»Ÿä¸€ resize åˆ° ViT é¢„è®­ç»ƒå°ºå¯¸ï¼ˆå¦‚ 518Ã—518ï¼‰ï¼Œç¼–ç å‡º 37Ã—37 tokensï¼›
        
    -   Decoder è¾“å‡ºåå†æ’å€¼/reshapeå›åŸå§‹ç½‘æ ¼å¤§å° `(H, W)`ã€‚
        
4.  **çµæ´»ç»„åˆ Stage-A / Stage-1 / Stage-B**
    
    -   Stage-Aï¼šåªçœ‹ RAE é‡å»ºè´¨é‡ï¼ˆMSE/MAEï¼‰è¯„ä¼°æ½œç©ºé—´è¡¨è¾¾ï¼›
        
    -   Stage-1ï¼šç›´æ¥ç”¨ RAE åš deterministic é¢„æµ‹ï¼›
        
    -   Stage-Bï¼ˆå¯é€‰ï¼‰ï¼šåœ¨ latent ç©ºé—´ä¸Šå†å åŠ  DH-DiT / SimpleDiT åšæ‰©æ•£é¢„æµ‹ï¼ˆä½ å·²æœ‰çš„ RAE+LDM ç‰ˆæœ¬ï¼‰ã€‚
        

---

#### ä¸ä»»åŠ¡çš„å…³ç³»ï¼ˆå¤©æ°”é¢„æŠ¥ï¼‰

-   **ä¼˜åŠ¿**:
    
    -   âœ… **Decoder å¯é’ˆå¯¹å¤©æ°”åœºå¾®è°ƒ**ï¼šç›¸æ¯” SD VAE å›ºå®šä¸”åå›¾åƒï¼ŒRAE decoder åœ¨ ERA5 ä¸Šå¯é‡æ–°è®­ç»ƒï¼Œé‡å»º/é¢„æµ‹æ›´è´´åˆæ°”è±¡ç»“æ„ã€‚
        
    -   âœ… **åˆ©ç”¨å¤§è§„æ¨¡è§†è§‰é¢„è®­ç»ƒï¼ˆDINOv2ï¼‰**ï¼šåœ¨ç©ºé—´ç»“æ„ç†è§£ä¸Šå…·æœ‰ä¼˜åŠ¿ï¼Œæœ‰åˆ©äºæ•æ‰é”‹é¢ã€æ§½çº¿ã€æ¶¡æ—‹ç­‰æ¨¡å¼ã€‚
        
    -   âœ… **é«˜ç»´ latent è¡¨ç¤º**ï¼š1536Ã—37Ã—37 çš„ latent å®¹é‡è¿œå¤§äº 4Ã—(H/8Ã—W/8)ï¼Œæ›´é€‚åˆä¿ç•™å¤šå˜é‡ã€å¤šæ—¶é—´ä¿¡æ¯ã€‚
        
    -   âœ… **é€šç”¨æ€§å¼º**ï¼šåŒä¸€å¥— ExternalRepEncoder + RAEDecoder å¯ä»¥è¢« Stage-A é‡å»ºã€Stage-1 Directã€Stage-B æ‰©æ•£å…±äº«ä½¿ç”¨ã€‚
        
-   **å±€é™**:
    
    -   âŒ å¿…é¡»å¯¹ ERA5 ç½‘æ ¼åš resizeï¼ˆ64Ã—32 â†’ 518Ã—518ï¼‰ï¼Œå¸¦æ¥æ’å€¼è¯¯å·®ï¼›
        
    -   âŒ latent éå¸¸å¤§ï¼Œå¯¹æ˜¾å­˜å’Œç®—åŠ›è¦æ±‚è¾ƒé«˜ï¼›
        
    -   âŒ Decoder / in\_adapter éœ€è¦é¢å¤–è®­ç»ƒï¼Œå·¥ç¨‹å¤æ‚åº¦é«˜äºã€Œç›´æ¥ç”¨ SD VAEã€ã€‚
        

---

#### é€‚ç”¨åœºæ™¯

-   âœ… å¸Œæœ›åœ¨å¤©æ°”ä»»åŠ¡ä¸­åˆ©ç”¨ DINOv2 ç­‰**å¼ºé¢„è®­ç»ƒè§†è§‰æ¨¡å‹**ã€‚
    
-   âœ… éœ€è¦ **å¯å¾®è°ƒ decoder** æ¥é€‚åº” ERA5/WeatherBench æ•°æ®é›†ã€‚
    
-   âœ… å¯¹ç©ºé—´ç»“æ„ï¼ˆæ¨¡å¼è¯†åˆ«ã€æç«¯äº‹ä»¶ï¼‰ç²¾åº¦è¦æ±‚è¾ƒé«˜ï¼Œä¸æ»¡è¶³äºç®€å• CNN/VAEã€‚
    
-   âœ… æ˜¾å­˜ â‰¥ 24GB çš„è®­ç»ƒç¯å¢ƒï¼ˆå°¤å…¶æ˜¯ä½¿ç”¨ DINOv2-G/14 æ—¶ï¼‰ã€‚
    

---

#### ä¸ SD VAE çš„åŒºåˆ«ï¼ˆåœ¨æœ¬é¡¹ç›®ä¸­çš„å¯¹æ¯”ï¼‰

| ç‰¹æ€§ | SD VAE | RAE-Weather |
| --- | --- | --- |
| Latent channels | 4 | latent\_dimï¼ˆå¦‚ 1536 for DINOv2-G/14ï¼‰ |
| Latent ç©ºé—´ | (4, H/8, W/8) | (latent\_dim, H\_latent, W\_latent) |
| Encoder ä¸»å¹² | CNN-based VAE, å›ºå®š | ViT-basedï¼ˆDINOv2/MAE/SigLIP2ï¼‰ï¼Œå›ºå®š |
| Decoder | å›ºå®š | **å¯å¾®è°ƒ**ï¼ˆRAEDecoderï¼‰ |
| è¾“å…¥èŒƒå›´ / æ ‡å‡†åŒ– | \[-1,1\] / ç®€å•å½’ä¸€åŒ– | æ ‡å‡†åŒ–æ°”è±¡åœºï¼ˆæ•°æ®é›†ç»Ÿè®¡/æ°”å€™æ€ï¼‰ |
| æ˜¯å¦ resize è¾“å…¥ | é€šå¸¸ä¸éœ€è¦ | éœ€è¦ resize åˆ° encoder\_input\_size |
| ä¸ä»»åŠ¡çš„æ‹Ÿåˆæ–¹å¼ | VAE é‡å»ºå›¾åƒ | RAE é‡å»º & ç›´æ¥é¢„æµ‹å¤©æ°”åœº |

---

#### ä½¿ç”¨ç¤ºä¾‹ï¼ˆä¼ªä»£ç ï¼‰

**1\. ä»…ç”¨ RAE åšã€Œå†å² â†’ æœªæ¥ã€ç›´æ¥é¢„æµ‹ï¼ˆStage-1 Directï¼‰ï¼š**

```python
import torch
import timm
from src.models.diffusion.latent_rae_weather import RAEDiffusionWeather, RAEConfig, ExternalRepEncoder

# 1. æ„å»º DINOv2 backbone
backbone = timm.create_model("vit_giant_patch14_dinov2", pretrained=True)

# 2. ExternalRepEncoderï¼Œç”¨äºç¼–ç å†å²åºåˆ—
T_in, C_in, H, W = 12, 1, 64, 32
in_chans_hist = T_in * C_in

encoder_hist = ExternalRepEncoder(
    backbone=backbone,
    token_dim=1536,
    patch_size=14,
    in_chans=in_chans_hist,
    remove_cls=True,
    freeze=True,
    target_hw=(518, 518),
    mean=None,
    std=None,
).cuda()

# 3. æ„å»º RAE æ¨¡å‹ï¼Œåªç”¨ decoder
rae_cfg = RAEConfig(
    input_length=T_in,
    output_length=4,        # é¢„æµ‹4æ­¥æœªæ¥
    in_channels_history=C_in,
    out_channels_future=1,  # 2m_temperature
    token_dim=1536,
    patch_size=14,
)
rae = RAEDiffusionWeather(rae_cfg).cuda()

# 4. å†å²åºåˆ— â†’ tokens â†’ é¢„æµ‹æœªæ¥
B = 8
x_hist = torch.randn(B, T_in, C_in, H, W).cuda()    # (B,12,1,64,32)

x_in = x_hist.view(B, T_in * C_in, H, W)           # (B,12,64,32)
z, Hp, Wp = encoder_hist(x_in)                    # (B, N_tokens, 1536)

# ç›´æ¥ç”¨ RAEDecoder é¢„æµ‹æœªæ¥ 4 æ­¥
y_pred = rae.decode(z, Hp, Wp, H, W)              # (B, 4, 1, 64, 32)
print(y_pred.shape)
```

**2\. ä½¿ç”¨å·¥ç¨‹è„šæœ¬è®­ç»ƒ Stage-1 Directï¼ˆæ¨èï¼‰ï¼š**

```bash
python -m src.models.diffusion.train_stage1_direct_integrated \
  --variables "2m_temperature" \
  --time-slice "2015-01-01:2019-12-31" \
  --input-length 12 --output-length 4 \
  --batch-size 4 --lr 5e-5 --epochs 80 \
  --token-dim 1536 --patch-size 14 \
  --freeze-backbone true --train-in-adapter true \
  --encoder-ckpt "" \
  --output-dir ./outputs_stage1_direct_integrated
```

è®­ç»ƒå®Œæˆåï¼Œä½ å¯ä»¥åœ¨ï¼š

-   `outputs_stage1_direct_integrated/metrics_stage1_direct.json` æŸ¥çœ‹ RMSE/MAEï¼›
    
-   `outputs_stage1_direct_integrated/spatial_examples_stage1.png` çœ‹ç©ºé—´é‡å»º/é¢„æµ‹æ•ˆæœï¼›
    
-   `outputs_stage1_direct_integrated/decoder_fp16.pt` / `encoder_in_adapter_fp16.pt` è¯»å– decoder ä¸ in\_adapter æƒé‡ï¼Œç”¨äºåç»­ RAE+LDM çš„æ‰©æ•£å¤©æ°”é¢„æµ‹ã€‚
    



### Pixel U-Net

#### æ¨¡å‹ç»“æ„

```
è¾“å…¥: (batch, 12, channels, H, W)
  â†“
å±•å¹³æ—¶é—´ç»´åº¦: (batch, 12*channels, H, W)
  â†“
U-Net:
  ä¸‹é‡‡æ ·è·¯å¾„ (Encoder):
    ConvBlock â†’ MaxPool â†’ ConvBlock â†’ MaxPool â†’ ...
    ä¿ç•™skip connections
  â†“
  ç“¶é¢ˆå±‚ (Bottleneck):
    ConvBlock
  â†“
  ä¸Šé‡‡æ ·è·¯å¾„ (Decoder):
    UpSample â†’ Concat(skip) â†’ ConvBlock â†’ ...
  â†“
è¾“å‡º: (batch, 4*channels, H, W)
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

#### U-Netè¯¦ç»†ç»“æ„

```python
# å·ç§¯å—ï¼ˆä½¿ç”¨GroupNormå’ŒSiLUæ¿€æ´»ï¼‰
ConvBlock:
  Conv2d â†’ GroupNorm(8) â†’ SiLU â†’ Conv2d â†’ GroupNorm(8) â†’ SiLU

# ä¸‹é‡‡æ ·å—
DownBlock:
  ConvBlock(in_ch, out_ch) â†’ MaxPool2d(2)
  ä¿å­˜skip connectionï¼ˆç”¨äºä¸Šé‡‡æ ·æ—¶æ‹¼æ¥ï¼‰

# ä¸Šé‡‡æ ·å—
UpBlock:
  ConvTranspose2d(in_ch, in_ch//2, stride=2)
  Concat([up, skip])  # æ‹¼æ¥skip connection
  ConvBlock(in_ch//2+skip_ch, out_ch)

# æ•´ä½“ç»“æ„
è¾“å…¥: (B, T_in*C, H, W)
  â†’ è¾“å…¥å·ç§¯: (B, base_channels, H, W)
  â†’ ä¸‹é‡‡æ ·è·¯å¾„ï¼ˆdepthå±‚ï¼‰: é€æ­¥ä¸‹é‡‡æ ·ï¼Œä¿å­˜skip
  â†’ ç“¶é¢ˆå±‚: ConvBlock
  â†’ ä¸Šé‡‡æ ·è·¯å¾„ï¼ˆdepthå±‚ï¼‰: é€æ­¥ä¸Šé‡‡æ ·ï¼Œä½¿ç”¨skip
  â†’ è¾“å‡ºå·ç§¯: (B, T_out*C, H, W)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, channels, H, W)`
- **è¾“å‡º**: `(batch, output_length=4, channels, H, W)`
- **å…³é”®å‚æ•°**:
  - `base_channels`: åŸºç¡€é€šé“æ•°ï¼ˆé»˜è®¤64ï¼‰
  - `depth`: U-Netæ·±åº¦ï¼ˆé»˜è®¤4ï¼‰

#### å·¥ä½œåŸç†

1. **å›¾åƒåˆ°å›¾åƒé¢„æµ‹**: ç›´æ¥åœ¨åƒç´ ç©ºé—´è¿›è¡Œé¢„æµ‹
2. **å¤šå°ºåº¦ç‰¹å¾**: U-Netçš„ä¸‹é‡‡æ ·-ä¸Šé‡‡æ ·ç»“æ„æ•è·å¤šå°ºåº¦ç‰¹å¾
3. **Skipè¿æ¥**: ä¿ç•™ç»†èŠ‚ä¿¡æ¯ï¼Œé¿å…ä¿¡æ¯ä¸¢å¤±
4. **æ—¶é—´ä¿¡æ¯**: å°†å¤šä¸ªæ—¶é—´æ­¥ä½œä¸ºå¤šé€šé“è¾“å…¥

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… è®­ç»ƒå¿«é€Ÿï¼ˆç›´æ¥åœ¨åƒç´ ç©ºé—´ï¼‰
  - âœ… ç»“æœç¡®å®šï¼ˆæ— éšæœºæ€§ï¼‰
  - âœ… é€‚åˆå›¾åƒé¢„æµ‹ä»»åŠ¡

- **å±€é™**:
  - âŒ æ˜¾å­˜éœ€æ±‚å¤§ï¼ˆå¤§å°ºå¯¸å›¾åƒï¼‰
  - âŒ æ— æ—¶åºå»ºæ¨¡ï¼ˆæ—¶é—´æ­¥ä½œä¸ºé€šé“ï¼‰
  - âŒ æ— æ³•é‡åŒ–ä¸ç¡®å®šæ€§

#### é€‚ç”¨åœºæ™¯

- âœ… å°å°ºå¯¸å›¾åƒï¼ˆ64Ã—32ï¼‰
- âœ… å¿«é€ŸåŸå‹éªŒè¯
- âŒ ä¸é€‚åˆå¤§å°ºå¯¸å›¾åƒï¼ˆ512Ã—512ï¼‰

---

### Latent U-Net

#### æ¨¡å‹ç»“æ„

**ä½¿ç”¨SD VAE**:
```
è¾“å…¥å›¾åƒ: (batch, 12, channels, H, W)
  â†“
SD VAEç¼–ç  (åˆ†æ‰¹å¤„ç†ï¼Œæ§åˆ¶æ˜¾å­˜):
  (batch*12, channels, H, W) â†’ (batch*12, 4, H//8, W//8)
  â†“
é‡å¡‘: (batch, 12, 4, H//8, W//8)
  â†“
å±•å¹³æ—¶é—´ç»´åº¦: (batch, 12*4, H//8, W//8)
  â†“
Latent U-Net (åœ¨æ½œç©ºé—´):
  è¾“å…¥å·ç§¯ â†’ ä¸‹é‡‡æ ·è·¯å¾„ â†’ ç“¶é¢ˆ â†’ ä¸Šé‡‡æ ·è·¯å¾„ â†’ è¾“å‡ºå·ç§¯
  (ä½¿ç”¨ä¸Pixel U-Netç›¸åŒçš„U-Netç»“æ„ï¼Œä½†è¾“å…¥è¾“å‡ºé€šé“ä¸åŒ)
  â†“
è¾“å‡º: (batch, 4*4, H//8, W//8)
  â†“
é‡å¡‘: (batch, 4, 4, H//8, W//8)
  â†“
SD VAEè§£ç  (åˆ†æ‰¹å¤„ç†):
  (batch*4, 4, H//8, W//8) â†’ (batch*4, channels, H, W)
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

**ä½¿ç”¨RAE**:
```
è¾“å…¥å›¾åƒ: (batch, 12, channels, H, W)
  â†“
RAEç¼–ç  (åˆ†æ‰¹å¤„ç†):
  (batch*12, channels, H, W) 
    â†’ Resizeåˆ°encoder_input_size (å¦‚256Ã—256)
    â†’ Vision Transformer Encoder (DINOv2/SigLIP2/MAE)
    â†’ (batch*12, latent_dim, H_latent, W_latent)
    # latent_dimå–å†³äºencoderï¼ˆå¦‚768 for DINOv2-baseï¼‰
    # H_latent, W_latent = encoder_input_size // patch_size
  â†“
é‡å¡‘: (batch, 12, latent_dim, H_latent, W_latent)
  â†“
å±•å¹³æ—¶é—´ç»´åº¦: (batch, 12*latent_dim, H_latent, W_latent)
  â†“
Latent U-Net (åœ¨æ½œç©ºé—´):
  è¾“å…¥å·ç§¯ â†’ ä¸‹é‡‡æ ·è·¯å¾„ â†’ ç“¶é¢ˆ â†’ ä¸Šé‡‡æ ·è·¯å¾„ â†’ è¾“å‡ºå·ç§¯
  (ä¸SD VAEç‰ˆæœ¬ç»“æ„ç›¸åŒï¼Œä½†latent_channels=latent_dim)
  â†“
è¾“å‡º: (batch, 4*latent_dim, H_latent, W_latent)
  â†“
é‡å¡‘: (batch, 4, latent_dim, H_latent, W_latent)
  â†“
RAEè§£ç  (åˆ†æ‰¹å¤„ç†ï¼Œdecoderå¯å¾®è°ƒ):
  (batch*4, latent_dim, H_latent, W_latent)
    â†’ Vision Transformer Decoder (MAE-basedï¼Œå¯è®­ç»ƒ)
    â†’ (batch*4, channels, H, W)
  â†“
é‡å¡‘: (batch, 4, channels, H, W)
```

#### è¾“å…¥è¾“å‡º

- **è¾“å…¥**: `(batch, input_length=12, channels, H, W)` - åƒç´ ç©ºé—´
- **è¾“å‡º**: `(batch, output_length=4, channels, H, W)` - åƒç´ ç©ºé—´
- **ä¸­é—´è¡¨ç¤ºï¼ˆSD VAEï¼‰**: æ½œç©ºé—´ `(batch, T, 4, H//8, W//8)`
- **ä¸­é—´è¡¨ç¤ºï¼ˆRAEï¼‰**: æ½œç©ºé—´ `(batch, T, latent_dim, H_latent, W_latent)`
- **å…³é”®å‚æ•°**:
  - `vae_type`: VAEç±»å‹ï¼Œ'sd' æˆ– 'rae'
  - `base_channels`: U-NetåŸºç¡€é€šé“æ•°ï¼ˆé»˜è®¤128ï¼‰
  - `depth`: U-Netæ·±åº¦ï¼ˆé»˜è®¤3ï¼‰
  - `vae_batch_size`: VAEç¼–ç /è§£ç æ‰¹æ¬¡å¤§å°ï¼ˆæ§åˆ¶æ˜¾å­˜ï¼‰
  - **SD VAEç‰¹å®šå‚æ•°**:
    - `vae_model_id`: SD VAEæ¨¡å‹IDï¼ˆé»˜è®¤'stable-diffusion-v1-5'ï¼‰
    - `vae_pretrained_path`: å¯é€‰ï¼Œé¢„è®­ç»ƒæƒé‡è·¯å¾„ï¼ˆè¦†ç›–é»˜è®¤SDæƒé‡ï¼‰
    - `freeze_encoder`: æ˜¯å¦å†»ç»“encoder
    - `freeze_decoder`: æ˜¯å¦å†»ç»“decoder
  - **RAEç‰¹å®šå‚æ•°**:
    - `rae_encoder_cls`: Encoderç±»å‹ï¼ˆ'Dinov2withNorm', 'SigLIP2wNorm', 'MAEwNorm'ï¼‰
    - `rae_encoder_config_path`: Encoderé…ç½®è·¯å¾„
    - `rae_encoder_input_size`: Encoderè¾“å…¥å°ºå¯¸ï¼ˆé»˜è®¤256ï¼‰
    - `rae_decoder_config_path`: Decoderé…ç½®è·¯å¾„
    - `rae_decoder_patch_size`: Decoder patchå¤§å°ï¼ˆé»˜è®¤16ï¼‰
    - `freeze_encoder`: å†»ç»“encoderï¼ˆé»˜è®¤Trueï¼‰
    - `freeze_decoder`: å†»ç»“decoderï¼ˆé»˜è®¤Falseï¼‰

#### å·¥ä½œåŸç†

1. **VAEç¼–ç **: 
   - **SD VAE**: å°†è¾“å…¥å›¾åƒç¼–ç åˆ°æ½œç©ºé—´ï¼ˆå‹ç¼©64å€ï¼Œ4é€šé“ï¼‰
     - ä»…æ”¯æŒåŠ è½½é¢„è®­ç»ƒæƒé‡ï¼Œå¯è‡ªå®šä¹‰è·¯å¾„
     - é€šè¿‡ `freeze_encoder` / `freeze_decoder` æ§åˆ¶å“ªäº›éƒ¨åˆ†å‚ä¸è®­ç»ƒ
   - **RAE**: å°†è¾“å…¥å›¾åƒresizeåç¼–ç åˆ°æ½œç©ºé—´ï¼ˆlatent_dimé€šé“ï¼Œå¦‚768ï¼‰
2. **æ½œç©ºé—´é¢„æµ‹**: U-Netåœ¨æ½œç©ºé—´ä¸­é¢„æµ‹æœªæ¥å¸§
3. **VAEè§£ç **: 
   - **SD VAE**: å°†é¢„æµ‹çš„æ½œå‘é‡è§£ç å›åƒç´ ç©ºé—´
     - é»˜è®¤è§£ç å™¨å¯è®­ç»ƒï¼Œå¯é€šè¿‡ `freeze_decoder` å…³é—­å¾®è°ƒ
   - **RAE**: å°†é¢„æµ‹çš„æ½œå‘é‡è§£ç å›åƒç´ ç©ºé—´ï¼ˆå¯å¾®è°ƒdecoderï¼‰

4. **ä¼˜åŠ¿**:
   - **SD VAE**: æ˜¾å­˜éœ€æ±‚ä½ï¼ˆæ½œç©ºé—´æ¯”åƒç´ ç©ºé—´å°64å€ï¼‰ï¼Œé¢„è®­ç»ƒæ¨¡å‹ç¨³å®šï¼Œæ”¯æŒVAEå¾®è°ƒ
   - **RAE**: Decoderå¯å¾®è°ƒï¼Œå¯èƒ½è·å¾—æ›´å¥½çš„é‡å»ºè´¨é‡ï¼Œæ”¯æŒå¤šç§encoderé€‰æ‹©

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… **æ˜¾å­˜éœ€æ±‚ä½**ï¼ˆ512Ã—512 â†’ 64Ã—64 for SD VAEï¼‰
  - âœ… è®­ç»ƒæ›´ç¨³å®š
  - âœ… ç”Ÿæˆç»“æœæ›´å¹³æ»‘
  - âœ… é€‚åˆå¤§å°ºå¯¸å›¾åƒ
  - âœ… **SD VAE**: encoder/decoderå‡å¯å•ç‹¬å¾®è°ƒ
  - âœ… **RAE**: Decoderå¯å¾®è°ƒï¼Œå¯èƒ½è·å¾—æ›´å¥½çš„é‡å»ºè´¨é‡

- **å±€é™**:
  - âŒ VAEé‡å»ºè¯¯å·®ï¼ˆ5-10K for SD VAEï¼Œå¯é€šè¿‡å¾®è°ƒæ”¹å–„ï¼‰
  - âŒ éœ€è¦VAEç¼–ç /è§£ç æ­¥éª¤ï¼ˆå¢åŠ è®¡ç®—æ—¶é—´ï¼‰
  - âŒ æ— æ³•é‡åŒ–ä¸ç¡®å®šæ€§
  - âŒ **RAE**: Encoderéœ€è¦resizeè¾“å…¥ï¼Œlatentç»´åº¦æ›´å¤§

#### é€‚ç”¨åœºæ™¯

- âœ… **å¤§å°ºå¯¸å›¾åƒé¢„æµ‹**ï¼ˆæ¨èï¼‰
- âœ… æ˜¾å­˜æœ‰é™çš„æƒ…å†µï¼ˆSD VAEï¼‰
- âœ… éœ€è¦å¹³æ»‘é¢„æµ‹ç»“æœçš„ä»»åŠ¡
- âœ… **éœ€è¦å¯å¾®è°ƒdecoder**ï¼ˆRAEï¼‰

---

### Diffusion Model

#### æ¨¡å‹ç»“æ„

```
è®­ç»ƒé˜¶æ®µ:
  æ¡ä»¶ï¼ˆè¿‡å»å¸§ï¼‰: (batch, 12, channels, H, W)
    â†“ VAEç¼–ç 
  æ¡ä»¶æ½œå‘é‡: (batch, 12, 4, H//8, W//8)
  
  ç›®æ ‡ï¼ˆæœªæ¥å¸§ï¼‰: (batch, 4, channels, H, W)
    â†“ VAEç¼–ç 
  ç›®æ ‡æ½œå‘é‡: (batch, 4, 4, H//8, W//8)
    â†“
  æ·»åŠ å™ªå£°: latent_target + noise * sqrt(beta_t)
    â†“
  U-Neté¢„æµ‹å™ªå£°: predicted_noise
    â†“
  æŸå¤±: MSE(predicted_noise, true_noise)

æ¨ç†é˜¶æ®µ:
  æ¡ä»¶æ½œå‘é‡: (batch, 12, 4, H//8, W//8)
  éšæœºå™ªå£°: (batch, 4, 4, H//8, W//8)
    â†“
  é€æ­¥å»å™ª (Tæ­¥):
    for t in [T-1, ..., 0]:
      predicted_noise = U-Net(noisy_latent, t, condition)
      latent = scheduler.step(predicted_noise, t, latent)
    â†“
  å»å™ªåçš„æ½œå‘é‡: (batch, 4, 4, H//8, W//8)
    â†“ VAEè§£ç 
  é¢„æµ‹å›¾åƒ: (batch, 4, channels, H, W)
```

#### Diffusion U-Netç»“æ„

```python
# å¸¦æ—¶é—´åµŒå…¥çš„U-Net
è¾“å…¥: 
  - noisy_latent: (B, 4*4, H//8, W//8)  # åŠ å™ªçš„æœªæ¥å¸§
  - condition: (B, 12*4, H//8, W//8)   # è¿‡å»å¸§
  - timestep: (B,)
  
æ‹¼æ¥: (B, (12+4)*4, H//8, W//8)
  â†“
æ—¶é—´åµŒå…¥: TimestepEmbedding(timestep) â†’ (B, time_emb_dim)
  â†“
U-Net (å¸¦æ—¶é—´åµŒå…¥):
  ä¸‹é‡‡æ ·å—: ConvBlockWithTime(x, time_emb)
  ç“¶é¢ˆå±‚: ConvBlockWithTime(x, time_emb)
  ä¸Šé‡‡æ ·å—: ConvBlockWithTime(x, time_emb)
  â†“
è¾“å‡º: (B, 4*4, H//8, W//8)  # é¢„æµ‹çš„å™ªå£°
```

#### è¾“å…¥è¾“å‡º

- **è®­ç»ƒ**:
  - **è¾“å…¥**: 
    - æ¡ä»¶: `(batch, input_length=12, channels, H, W)`
    - ç›®æ ‡: `(batch, output_length=4, channels, H, W)`
  - **è¾“å‡º**: é¢„æµ‹çš„å™ªå£° `(batch, output_length=4, 4, H//8, W//8)`

- **æ¨ç†**:
  - **è¾“å…¥**: æ¡ä»¶ `(batch, input_length=12, channels, H, W)`
  - **è¾“å‡º**: é¢„æµ‹ `(batch, output_length=4, channels, H, W)`
  - **å¯é€‰**: ç”Ÿæˆå¤šä¸ªæ ·æœ¬ï¼ˆé›†æˆé¢„æµ‹ï¼‰

#### å·¥ä½œåŸç†

1. **å‰å‘æ‰©æ•£è¿‡ç¨‹ï¼ˆè®­ç»ƒï¼‰**:
   - é€æ­¥å‘ç›®æ ‡æ·»åŠ å™ªå£°: `x_t = sqrt(alpha_t) * x_0 + sqrt(1-alpha_t) * noise`
   - å­¦ä¹ é¢„æµ‹æ¯ä¸€æ­¥æ·»åŠ çš„å™ªå£°

2. **åå‘å»å™ªè¿‡ç¨‹ï¼ˆæ¨ç†ï¼‰**:
   - ä»éšæœºå™ªå£°å¼€å§‹
   - é€æ­¥å»å™ªï¼Œæ¯æ­¥é¢„æµ‹å¹¶ç§»é™¤å™ªå£°
   - æœ€ç»ˆå¾—åˆ°æ¸…æ™°çš„é¢„æµ‹ç»“æœ

3. **æ¡ä»¶ç”Ÿæˆ**:
   - å°†è¿‡å»å¸§ä½œä¸ºæ¡ä»¶è¾“å…¥U-Net
   - U-Netæ ¹æ®æ¡ä»¶å’Œæ—¶é—´æ­¥é¢„æµ‹å™ªå£°

4. **ä¸ç¡®å®šæ€§é‡åŒ–**:
   - å¯ä»¥ç”Ÿæˆå¤šä¸ªæ ·æœ¬ï¼ˆä¸åŒéšæœºç§å­ï¼‰
   - é›†æˆé¢„æµ‹æä¾›ä¸ç¡®å®šæ€§ä¼°è®¡

#### å™ªå£°è°ƒåº¦å™¨

```python
# DDPMè°ƒåº¦å™¨
beta_t = linear_schedule(0.0001, 0.02, T=1000)
alpha_t = 1 - beta_t
alpha_bar_t = cumprod(alpha_t)

# æ·»åŠ å™ªå£°
noisy = sqrt(alpha_bar_t) * x_0 + sqrt(1 - alpha_bar_t) * noise

# å»å™ªæ­¥éª¤
predicted_x_0 = (x_t - sqrt(1-alpha_bar_t) * predicted_noise) / sqrt(alpha_bar_t)
x_{t-1} = sqrt(alpha_bar_{t-1}) * predicted_x_0 + sqrt(1-alpha_bar_{t-1}) * predicted_noise
```

#### ä¸ä»»åŠ¡çš„å…³ç³»

- **ä¼˜åŠ¿**:
  - âœ… **ä¸ç¡®å®šæ€§é‡åŒ–**: å¯ä»¥ç”Ÿæˆå¤šä¸ªæœªæ¥åœºæ™¯
  - âœ… **é›†æˆé¢„æµ‹**: å¤šä¸ªæ ·æœ¬çš„å¹³å‡æ›´å‡†ç¡®
  - âœ… **æ¦‚ç‡å»ºæ¨¡**: é€‚åˆå¤©æ°”ç³»ç»Ÿçš„æ··æ²Œç‰¹æ€§
  - âœ… **é«˜è´¨é‡ç”Ÿæˆ**: Diffusionæ¨¡å‹ç”Ÿæˆè´¨é‡é«˜

- **å±€é™**:
  - âŒ è®­ç»ƒæ—¶é—´é•¿ï¼ˆéœ€è¦å­¦ä¹ å»å™ªè¿‡ç¨‹ï¼‰
  - âŒ æ¨ç†æ…¢ï¼ˆéœ€è¦å¤šæ­¥å»å™ªï¼Œå¦‚50-1000æ­¥ï¼‰
  - âŒ æ˜¾å­˜éœ€æ±‚å¤§ï¼ˆU-Net + VAEï¼‰

#### é€‚ç”¨åœºæ™¯

- âœ… **éœ€è¦ä¸ç¡®å®šæ€§ä¼°è®¡çš„ä»»åŠ¡**ï¼ˆæ¨èï¼‰
- âœ… é›†æˆé¢„æµ‹
- âœ… æ¦‚ç‡å¤©æ°”é¢„æŠ¥
- âŒ ä¸é€‚åˆå¿«é€Ÿæ¨ç†åœºæ™¯

---

## æ¨¡å‹å¯¹æ¯”ä¸é€‰æ‹©

### æ¨¡å‹ç‰¹æ€§å¯¹æ¯”è¡¨

| æ¨¡å‹ | æ—¶ç©ºå»ºæ¨¡ | è®­ç»ƒé€Ÿåº¦ | æ¨ç†é€Ÿåº¦ | ä¸ç¡®å®šæ€§ | æ˜¾å­˜éœ€æ±‚ | å‚æ•°é‡ | æ¨èåœºæ™¯ |
|------|---------|---------|---------|---------|---------|--------|---------|
| **Linear Regression** | âœ— | âš¡âš¡âš¡ | âš¡âš¡âš¡ | âœ— | ä½ | å¾ˆå°‘ | å¿«é€ŸåŸºçº¿ |
| **LSTM** | æ—¶åº | âš¡âš¡ | âš¡âš¡ | âœ— | ä¸­ | ä¸­ | å•ç‚¹é¢„æµ‹ |
| **Transformer** | æ—¶åº | âš¡âš¡ | âš¡âš¡ | âœ— | ä¸­ | ä¸­ | å•ç‚¹é¢„æµ‹ï¼ˆé•¿è·ç¦»ä¾èµ–ï¼‰ |
| **CNN** | ç©ºé—´ | âš¡âš¡ | âš¡âš¡âš¡ | âœ— | ä¸­ | ä¸­ | ç©ºé—´æ¨¡å¼ |
| **ConvLSTM** | æ—¶ç©º | âš¡ | âš¡âš¡ | âœ— | ä¸­ | ä¸­ | **é€šç”¨é¢„æµ‹** â­ |
| **Weather Transformer** | æ—¶ç©º | âš¡ | âš¡ | âœ— | ä¸­ | å°‘ | é•¿è·ç¦»ä¾èµ– |
| **Pixel U-Net** | ç©ºé—´(é€šé“å †å ) | âš¡âš¡ | âš¡âš¡ | âœ— | é«˜ | ä¸­ | å°å›¾åƒ |
| **Latent U-Net (SD VAE)** | ç©ºé—´(æ½œç©ºé—´å †å ) | âš¡âš¡ | âš¡âš¡ | âœ— | ä½ | ä¸­ | **å¤§å›¾åƒ** â­ |
| **Latent U-Net (RAE)** | ç©ºé—´(æ½œç©ºé—´å †å ) | âš¡âš¡ | âš¡âš¡ | âœ— | ä¸­ | ä¸­ | **å¤§å›¾åƒï¼ˆå¯å¾®è°ƒï¼‰** â­ |
| **Diffusion** | æ—¶ç©º | ğŸ¢ | ğŸ¢ | âœ“ | é«˜ | ä¸­ | **æ¦‚ç‡é¢„æµ‹** â­ |

### é€‰æ‹©æŒ‡å—

#### 1. å¿«é€ŸåŸºçº¿æµ‹è¯•
- **æ¨è**: Linear Regression
- **åŸå› **: è®­ç»ƒæå¿«ï¼ŒéªŒè¯æ•°æ®æµ

#### 2. ç¡®å®šæ€§é¢„æµ‹ï¼ˆé€šç”¨ï¼‰
- **æ¨è**: ConvLSTM æˆ– Latent U-Net
- **ConvLSTM**: é€‚åˆ64Ã—32å°å°ºå¯¸ï¼Œè®­ç»ƒå¿«
- **Latent U-Net (SD VAE)**: é€‚åˆ512Ã—512å¤§å°ºå¯¸ï¼Œæ˜¾å­˜å‹å¥½
- **Latent U-Net (RAE)**: é€‚åˆ512Ã—512å¤§å°ºå¯¸ï¼Œdecoderå¯å¾®è°ƒ

#### 3. ä¸ç¡®å®šæ€§é‡åŒ–
- **æ¨è**: Diffusion Model
- **åŸå› **: å”¯ä¸€æ”¯æŒæ¦‚ç‡é¢„æµ‹çš„æ¨¡å‹

#### 4. è®¡ç®—èµ„æºæœ‰é™
- **CPU**: Linear Regression, LSTM
- **å•GPU (8GB)**: CNN, ConvLSTM
- **å•GPU (12GB+)**: Latent U-Net, Diffusion

#### 5. å¤§å°ºå¯¸å›¾åƒï¼ˆ512Ã—512ï¼‰
- **æ¨è**: Latent U-Net (SD VAE æˆ– RAE)
- **SD VAE**: æ˜¾å­˜éœ€æ±‚ä½ï¼Œè®­ç»ƒç¨³å®š
- **RAE**: Decoderå¯å¾®è°ƒï¼Œå¯èƒ½è·å¾—æ›´å¥½çš„é‡å»ºè´¨é‡

### æ¨¡å‹ä¸ä»»åŠ¡çš„å…³ç³»æ€»ç»“

1. **æ—¶ç©ºå»ºæ¨¡éœ€æ±‚**:
   - âœ… ConvLSTM, Weather Transformer, Latent U-Net, Diffusion
   - âš ï¸ Transformer, LSTM (ä»…æ—¶åºï¼Œæ— ç©ºé—´)
   - âŒ Linear Regression, CNN (æ— æ—¶åº)

2. **ä¸ç¡®å®šæ€§éœ€æ±‚**:
   - âœ… Diffusion Model
   - âŒ å…¶ä»–æ‰€æœ‰æ¨¡å‹ï¼ˆç¡®å®šæ€§ï¼‰

3. **è®¡ç®—æ•ˆç‡éœ€æ±‚**:
   - âœ… Linear Regression, CNN, Pixel U-Net
   - âŒ Diffusion Model

4. **å¤§å°ºå¯¸æ•°æ®**:
   - âœ… Latent U-Net (SD VAE æˆ– RAEå‹ç¼©)
   - âŒ Pixel U-Net (æ˜¾å­˜ä¸è¶³)

5. **éœ€è¦å¯å¾®è°ƒdecoder**:
   - âœ… Latent U-Net (RAE)
   - âŒ Latent U-Net (SD VAEï¼Œdecoderå›ºå®š)

---

## æ€»ç»“

æœ¬é¡¹ç›®æä¾›äº†ä»ç®€å•åŸºçº¿åˆ°å¤æ‚æ¦‚ç‡æ¨¡å‹çš„å®Œæ•´æ¨¡å‹ä½“ç³»ï¼š

1. **ä¼ ç»Ÿæ¨¡å‹**: é€‚åˆå¿«é€ŸéªŒè¯å’Œç®€å•ä»»åŠ¡
2. **ConvLSTM**: ç¡®å®šæ€§é¢„æµ‹çš„æœ€ä½³é€‰æ‹©
3. **WeatherDiffæ¨¡å—**: 
   - **Latent U-Net (SD VAE)**: å¤§å°ºå¯¸å›¾åƒçš„ç¡®å®šæ€§é¢„æµ‹ï¼Œæ˜¾å­˜å‹å¥½
   - **Latent U-Net (RAE)**: å¤§å°ºå¯¸å›¾åƒçš„ç¡®å®šæ€§é¢„æµ‹ï¼Œdecoderå¯å¾®è°ƒ
   - **Diffusion**: æ¦‚ç‡é¢„æµ‹å’Œä¸ç¡®å®šæ€§é‡åŒ–

é€‰æ‹©åˆé€‚çš„æ¨¡å‹éœ€è¦æƒè¡¡ï¼š
- é¢„æµ‹ç²¾åº¦ vs è®¡ç®—æ•ˆç‡
- ç¡®å®šæ€§ vs ä¸ç¡®å®šæ€§
- æ¨¡å‹å¤æ‚åº¦ vs æ•°æ®é‡
- å›ºå®šdecoder vs å¯å¾®è°ƒdecoder

å»ºè®®ä»ConvLSTMå¼€å§‹ï¼Œç„¶åæ ¹æ®éœ€æ±‚é€‰æ‹©ï¼š
- **å¤§å°ºå¯¸å›¾åƒï¼ˆ512Ã—512ï¼‰**: Latent U-Net (SD VAE æˆ– RAE)
- **éœ€è¦ä¸ç¡®å®šæ€§ä¼°è®¡**: Diffusion
- **éœ€è¦å¯å¾®è°ƒdecoder**: Latent U-Net (RAE)
